{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block content
    %}
<!--  -->
<link rel="stylesheet" href="static/main.css">
<p></p>
<div class="site-header-logo">
    <h1 class="text-center">
        Company Attendance Dashboard
    </h1>
</div>
<p></p>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
            body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
}
.hid{

    z-index: -2;

}
.card-row {
    display: flex;
    justify-content: space-between; /* Distribute card rows evenly */
    margin-bottom: 30px; /* Add margin between card rows */
}
.card {
  position: relative;
  left: -210px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  padding: 20px;
  margin: 20px;
  min-height: 500px;
  min-width : 750px;
}

.transparent-card {
            position: absolute;
            top: 90px;
            left: 200px;
            width: 1700px;
            height: 800px;
            background-color: rgba(0, 0, 0, 0.5); /* Adjust the transparency here */
            z-index: -1; /* Place the transparent card behind other content */
            border-radius: 40px;

        }
.chart-container {
    width: 100%; /* Adjust the width as needed */
  height: 100%;  /* Adjust the height as needed */
}
      canvas {
        width: 100%;
  height: 100%;
      }
      .nav-list {
    display: flex;
    list-style: none;
    padding: 0;
}

.nav-list li {
    text-align: center;
    margin-right: 18px; /* Adjust spacing between items */
}

.nav-label {
    display: block;
    font-size: 20px; /* Adjust font size as needed */
}
    </style>

  <meta charset="UTF-8">
  <title>Side Navigation Bar</title>
  <link rel="stylesheet" href="static/styles.css">
  <script src="https://kit.fontawesome.com/b99e675b6e.js"></script>
</head>
<body>
<div class="wrapper">
    <div class="sidebar">
       
      <ul>
        <li><a href="/dashboardpage_1"><i class="fas fa-home"></i>  <span class="nav-label">Overall</span></a></li>
        <li><a href="/dashboardpage_3"><i class="fas fa-database"></i><span class="nav-label">Department Performance</span></a></li>
        <li><a href="/dashboardpage_2"><i class="fas fa-address-card"></i><span class="nav-label">Personal Performance</span></a></li>
        <li><a href="/dashboardpage_4"><i class="fas fa-project-diagram"></i><span class="nav-label">Attendance Checker</span></a></li>
    </ul> 
    </div>
  </div>
<!-- Second Graph  -->
<!-- Add the Chart.js library for bar chart support -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1"></script>
<!-- Add a container for the bar chart -->
<p></p>
<div class="transparent-card"></div>

<div class="card-row">
<div class="card">
    <div class="chart-container">
        <h2>Each Employee Attendance Graph</h2>
        <div>
           
            <!-- -->
            
                <label for="graphType1"  style="display: none;">Select Graph Type:</label>
                <select id="graphType1" onchange="updateGraph1()" style="display: none;">
                  
                  
                  <option value="bar">Bar Graph</option>
                </select>
               
         
        </div>
          <div>
            <label for="xAxisLabel1" style="display: none;">Select X-Axis Label:</label>
            <select id="xAxisLabel1" onchange="updateGraph1()" style="display: none;">
              <option value="Attend">Attend</option>
              <option value="Not Attend">Did Not Attend</option>
              <option value="Both">Both</option>
            </select>
            <select id="startMonth">
              <option value="01">January</option>
              <option value="02">February</option>
              <option value="03">March</option>
              <option value="04">April</option>
              <option value="05">May</option>
              <option value="06">June</option>
              <option value="07">July</option>
              <option value="08">August</option>
              <option value="09">September</option>
              <option value="010">October</option>
              <option value="011">November</option>
              <option value="012">December</option>

              <!-- Add other months here -->
            </select>
            <select id="startYear">
              <option value="2015">2015</option>
              <option value="2016">2016</option>
              <option value="2017">2017</option>
              <option value="2018">2018</option>
              <!-- Add other years here -->
            </select>
            <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <select id="endMonth">
              <option value="01">January</option>
              <option value="02">February</option>
              <option value="03">March</option>
              <option value="04">April</option>
              <option value="05">May</option>
              <option value="06">June</option>
              <option value="07">July</option>
              <option value="08">August</option>
              <option value="09">September</option>
              <option value="010">October</option>
              <option value="011">November</option>
              <option value="012">December</option>
              <!-- Add other months here -->
            </select>

            <select id="endYear">
              <option value="2015">2015</option>
              <option value="2016">2016</option>
              <option value="2017">2017</option>
              <option value="2018">2018</option>
              <!-- Add other years here -->
            </select>
          </div>
          
        <canvas id="barChart"></canvas>

    </div>
    </div>
    
<div class="card">
  <div class="chart-container">
      <h2>Comparing Selected Employee Attendance Based on Month or Year</h2>
      <div>
          <h2></h2>
          <label for="first-select">Select a number (1-9):</label>
          <select id="first-select" onchange="createSelectBars2()">
            
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
          </select>
        </div>
        <div id="select-bar-container"></div>
        <div>
          <label for="x-axis-select">Select X-Axis:</label>
          <select id="x-axis-select" onchange="updateLineGraph2()">
            <option value="years">Years</option>
            <option value="months">Months</option>
          </select>
        </div>
        <canvas id="line-chart"></canvas>
  </div>
  </div>
  </div>

<script>
  // Fetch the dataset from the Flask API

  fetch('/api/data')
    .then(response => response.json())
    .then(data => {
      let chart1;
      let graphData1 = {
        labels: [], // Array to store the x-axis labels (IDs)
        datasets: [] // Array to store the bar datasets
      };

      function updateGraph1() {
        const startMonth = document.getElementById('startMonth').value;
        const endMonth = document.getElementById('endMonth').value;
        const startYear = document.getElementById('startYear').value;
        const endYear = document.getElementById('endYear').value;

        const graphTypeSelect1 = document.getElementById('graphType1');
        const graphxAxisLabel1 =document.getElementById('xAxisLabel1'); 
        const selectedGraphType1 = "bar";
        const selectedAxisLabel1 = "Both";




        // Count the Attend and DidNotAttend values for each ID
        const attendCountPerID = {};
        const didNotAttendCountPerID = {};

        const filteredData = data.dataset.filter(dataItem => {
        const date = new Date(dataItem["Date"]);
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        
        const startDate = new Date(`${startYear}-${startMonth}-01`);
        const endDate = new Date(`${endYear}-${endMonth}-01`);
        
        return date >= startDate && date <= endDate;
      });

        filteredData.forEach(dataItem => {
          
          const id = dataItem["ID"];
          const attendValue = parseInt(dataItem["Attend"]);
      

          // Increment the count for each ID based on Attend or DidNotAttend
          if (attendValue === 1) {
            if (attendCountPerID[id]) {
              attendCountPerID[id] += 1;
            } else {
              attendCountPerID[id] = 1;
            }
          } else {
            if (didNotAttendCountPerID[id]) {
              didNotAttendCountPerID[id] += 1;
            } else {
              didNotAttendCountPerID[id] = 1;
            }
          }
        });
        // Prepare the data for the bar graph
        graphData1.labels = Object.keys(attendCountPerID); // Array of IDs as labels
        graphData1.datasets = []; // Clear the datasets array

        if (selectedAxisLabel1 === "Attend") {
          graphData1.datasets.push({
            label: "Attend Count",
            data: Object.values(attendCountPerID), // Array of Attend counts
            backgroundColor: getColors(Object.keys(attendCountPerID).length) // Array of colors for each ID
          });
        } else if (selectedAxisLabel1 === "Both" && selectedGraphType1 === "pie") {
          console.log("Data fetched successfully");
          graphData1.datasets.push({
            label: "Attend Count",
            data: Object.values(attendCountPerID), // Array of Attend counts
            backgroundColor: getColors(Object.keys(attendCountPerID).length) // Array of colors for each ID
          });

          graphData1.datasets.push({
            label: "Did Not Attend Count",
            data: Object.values(didNotAttendCountPerID), // Array of DidNotAttend counts
            backgroundColor: getColors(Object.keys(attendCountPerID).length) // Array of colors for each ID
          });
        } else if (selectedAxisLabel1 === "Both" && selectedGraphType1 === "bar"){
            console.log("Data fetched successfully");
            graphData1.datasets.push({
              label: "Attend Count",
              data: Object.values(attendCountPerID), // Array of Attend counts
              backgroundColor: 'rgba(255, 99, 132, 0.5)' // Array of colors for each ID
            });
            graphData1.datasets.push({
              label: "Did Not Attend Count",
              data: Object.values(didNotAttendCountPerID), // Array of DidNotAttend counts
              backgroundColor: 'rgba(75, 192, 192, 0.5)' // Array of colors for each ID
            });


        }else {
          graphData1.datasets.push({
            label: "Did Not Attend Count",
            data: Object.values(didNotAttendCountPerID), // Array of DidNotAttend counts
            backgroundColor: getColors(Object.keys(attendCountPerID).length) // Array of colors for each ID
          });
        }
        // Sort the labels and datasets arrays based on the values in descending order
        graphData1.labels.sort((a, b) => attendCountPerID[b] - attendCountPerID[a]);
        graphData1.datasets.forEach(dataset => {
          dataset.data.sort((a, b) => b - a);
        });
        // Destroy the existing chart if it exists
        if (chart1) {
          chart1.destroy();
        }

        // Check if the graph should be closed
        if (selectedGraphType1 === "") {
          return; // Exit the function and do not create the chart
        }
        if (selectedAxisLabel1 === "") {
          return; // Exit the function and do not create the chart
        }

        // Create the bar chart
        const barCtx = document.getElementById('barChart').getContext('2d');
        chart1 = new Chart(barCtx, {
          type: selectedGraphType1,
          data: graphData1,
          options: {
            // Customize the chart options as needed
          }
        });
      }

      // Add event listener to the select elements
      const graphTypeSelect1 = document.getElementById('graphType1');
      const graphxAxisLabel1 = document.getElementById('xAxisLabel1');
      graphTypeSelect1.addEventListener('change', updateGraph1);
      graphxAxisLabel1.addEventListener('change', updateGraph1);

      const startMonth = document.getElementById('startMonth');
      const endMonth = document.getElementById('endMonth');
      const startYear = document.getElementById('startYear');
      const endYear = document.getElementById('endYear');
      startMonth.addEventListener('change', updateGraph1);
      endMonth.addEventListener('change', updateGraph1);
      startYear.addEventListener('change', updateGraph1);
      endYear.addEventListener('change', updateGraph1);



      // Initial creation of the chart with the default graph type
      updateGraph1();
    });
  // Function to generate an array of colors based on the number of IDs
  function getColors(numColors) {
    const colors = [];
    for (let i = 0; i < numColors; i++) {
      const color = getRandomColor();
      colors.push(color);
    }
    return colors;
  }

  // Function to generate a random color
  function getRandomColor() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
      color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
  }
</script>
<p></p>

<!-- third graph -->
<!-- Add the Chart.js library for line chart support -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1"></script>
<p></p>

<p></p>

<script>
  
  let chart2;
  const attendCountPerID = {};
  const didNotAttendCountPerID = {};
  // Update the line graph based on the selected IDs and X-axis
  function updateLineGraph2() {
    const selectedIDs = [];
    const selectBars = document.querySelectorAll('.select-bar select');
    selectBars.forEach(select => {
      const selectedID = select.value;
      if (selectedID) {
        selectedIDs.push(selectedID);
      }
    });

    const selectedXAxis = document.getElementById('x-axis-select').value;

    const labels = selectedXAxis === 'months' ? getUniqueMonths2() : getUniqueYears2();
    const datasets = [];

    selectedIDs.forEach(id => {
      const attendData = selectedXAxis === 'months' ? getMonthlyAttendanceCount2(id) : getYearlyAttendanceCount2(id);
      const dataset = {
        label: `ID ${id}`,
        data: attendData,
        fill: false,
        borderColor: getRandomColor(),
        tension: 0.4
      };

      datasets.push(dataset);
    });

    const data = {
      labels: labels,
      datasets: datasets
    };

    if (chart2) {
      chart2.destroy();
    }

    const chartElement = document.getElementById('line-chart');
    chart2 = new Chart(chartElement, {
      type: 'line',
      data: data,
      options: {
        responsive: true,
        plugins: {
          title: {
            display: true,
            text: 'Attendance Line Graph'
          }
        }
      }
    });
  }

  // Fetch the data and process it
  fetch('/api/data')
    .then(response => response.json())
    .then(data => {
      data.dataset.forEach(dataItem => {
        const id = dataItem["ID"];
        const attendValue = parseInt(dataItem["Attend"]);

        const date = new Date(dataItem["Date"]);
        const month = date.getMonth() + 1;
        const year = date.getFullYear();

        if (!attendCountPerID[id]) {
          attendCountPerID[id] = {};
        }

        if (attendValue === 1) {
          if (attendCountPerID[id][year]) {
            attendCountPerID[id][year][month] = (attendCountPerID[id][year][month] || 0) + 1;
          } else {
            attendCountPerID[id][year] = { [month]: 1 };
          }
        } else {
          if (attendCountPerID[id][year]) {
            attendCountPerID[id][year][month] = attendCountPerID[id][year][month] || 0;
          } else {
            attendCountPerID[id][year] = { [month]: 0 };
          }
        }
      });

      createSelectBars2();
    })
    .catch(error => {
      console.log(error);
    });

  // Get unique years from the dataset
  function getUniqueYears2() {
    const uniqueYears = new Set();

    for (const id in attendCountPerID) {
      for (const year in attendCountPerID[id]) {
        uniqueYears.add(year);
      }
    }

    return Array.from(uniqueYears);
  }

  // Get unique months from the dataset
  function getUniqueMonths2() {
    const uniqueMonths = new Set();

    for (const id in attendCountPerID) {
      for (const year in attendCountPerID[id]) {
        for (const month in attendCountPerID[id][year]) {
          uniqueMonths.add(`${year}-${month}`);
        }
      }
    }

    return Array.from(uniqueMonths);
  }

  // Get the monthly attendance count for a specific ID
  function getMonthlyAttendanceCount2(id) {
    const selectedXAxis = document.getElementById('x-axis-select').value;
    const counts = [];

    const labels = selectedXAxis === 'months' ? getUniqueMonths2() : getUniqueYears2();
    labels.forEach(label => {
      const [year, month] = label.split('-');
      const count = attendCountPerID[id][year] && attendCountPerID[id][year][month] ? attendCountPerID[id][year][month] : 0;
      counts.push(count);
    });

    return counts;
  }

  // Get the yearly attendance count for a specific ID
  function getYearlyAttendanceCount2(id) {
    const counts = [];

    const labels = getUniqueYears2();
    labels.forEach(year => {
      let count = 0;

      for (const month in attendCountPerID[id][year]) {
        count += attendCountPerID[id][year][month];
      }

      counts.push(count);
    });

    return counts;
  }

  // Generate a random color for the line graph dataset
  function getRandomColor2() {
    const letters = '0123456789ABCDEF';
    let color = '#';
    for (let i = 0; i < 6; i++) {
      color += letters[Math.floor(Math.random() * 16)];
    }
    return color;
  }

  // Create select bars based on the selected number
  function createSelectBars2() {
    const container = document.getElementById('select-bar-container');
    container.innerHTML = '';

    const firstSelect = document.getElementById('first-select');
    const selectedNumber = parseInt(firstSelect.value);

    for (let i = 0; i < selectedNumber; i++) {
      const selectBar = document.createElement('div');
      selectBar.classList.add('select-bar');
      const label = document.createElement('label');
      label.textContent = `Select ${i + 1}: `;
      const select = document.createElement('select');
      select.name = `select-${i + 1}`;

      for (const id in attendCountPerID) {
        const option = document.createElement('option');
        option.value = id;
        option.text = `ID ${id}`;
        select.appendChild(option);
      }

      select.addEventListener('change', () => {
        updateLineGraph2();
      });

      selectBar.appendChild(label);
      selectBar.appendChild(select);
      container.appendChild(selectBar);
    }

    updateLineGraph2();
  }
</script>
{% endblock %}
    